{% load humanize %}
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  </head>
  <body>
    <div style="white-space: nowrap;">
      Team: {{ team.name }}<br>
      Puzzle: {{ puzzle.name }}<br>
      {% if solved %}
      Solved! Answer: <b>{{ puzzle.answer }}</b><br>
      <hr />
      <form action="." method="POST">
	{% csrf_token %}
	Fun: <select id="fun" name="fun">
	  <option value=" " selected="selected"> </option>
	  <option value="1">1</option>
	  <option value="2">2</option>
	  <option value="3">3</option>
	  <option value="4">4</option>
	  <option value="5">5</option>
	</select>
	Difficulty: <select id="difficulty" name="difficulty">
	  <option value=" " selected="selected"> </option>
	  <option value="1">1</option>
	  <option value="2">2</option>
	  <option value="3">3</option>
	  <option value="4">4</option>
	  <option value="5">5</option>
	</select><br/>
	Comments: <span id="remaining">({{ commentlen }} characters max)</span><br/><textarea id="comment" name="comment" rows="8" cols="30" maxlength="{{commentlen }}"></textarea><br/>
	<input type="hidden" name="survey" value="true">
	<input id="submit" type="submit" value="Submit">
      </form>
      <script type="text/javascript">
	$('#submit').bind('submit', function(e) {
          $(this).find('input:submit').attr('disabled', 'disabled');
	});
	$('#comment').keyup(function(e) {
          $('#remaining').text("(" + ({{commentlen}}-$(this).val().length) + " characters left)");
        });
      </script>
      {% else %}
      <form action="." method="POST">
	{% csrf_token %}
	Answer: <input id="answer" type="text" name="answer" size="38" autofocus><br />
	Phone: <select name="phone">
	  {% for p in team.teamphone_set.all %}
	  <option value="{{ p.phone }}">{{ p.phone }}</option>
	  {% endfor %}
	</select>
	<input id="submit" type="submit" value="Submit">
      </form>
      <script type="text/javascript">
	window.onload = function() {
          document.getElementById("answer").focus()
	};
	$('#submit').bind('submit', function(e) {
          $(this).find('input:submit').attr('disabled', 'disabled');
	});
      </script>
      {% endif %}
      {% if answers %}
      {% if unresolved %}
      <hr/>
      In the Queue:
      <table>
	<tr><th>Time
	  <th>Attempt
	</tr>
        {% for a in answers %}
	{% if not a.resolved %}
	<tr>
	  <td>{{ a.timestamp|naturaltime }}:
	  <td>{{ a.answer }}
	</tr>
	{% endif %}
	{% endfor %}
      </table>
      {% endif %}
      {% if resolved %}
      <hr/>
      Previous Attempts:
      <table>
	<tr><th>Time
	  <th>Attempt
	</tr>
        {% for a in answers %}
	{% if a.resolved %}
	<tr>
	  <td>{{ a.timestamp|naturaltime }}:
	  <td>{{ a.answer }}
	</tr>
	{% endif %}
	{% endfor %}
      </table>
      {% endif %}
      {% endif %}
    </div>
  </body>
</html>
